#!/bin/bash
set -euo pipefail

echo "ğŸš€ Starte install_dependencies Skript..."
echo "ğŸ“‚ Aktuelles Verzeichnis (vor mkdir): $(pwd)"

# 1) Erstelle /var/www/html mit root-Rechten und gib ubuntu den Besitz
sudo mkdir -p /var/www/html
sudo chown ubuntu:ubuntu /var/www/html
echo "ğŸ“ Verzeichnis /var/www/html erstellt und Besitz auf ubuntu gesetzt."

# 2) Wechsel in den Web-Root (dort wird spÃ¤ter deployt)
cd /var/www/html || {
  echo "âŒ Fehler: /var/www/html existiert nicht oder konnte nicht betreten werden."
  exit 1
}
echo "ğŸ“‚ Neues Arbeitsverzeichnis: $(pwd)"

if ! command -v yarn &> /dev/null; then
  echo "ğŸ“¦ Yarn nicht gefunden. Installiere global..."
  npm install -g yarn
else
  echo "âœ… Yarn ist bereits installiert: $(yarn -v)"
fi

cd backend
echo "ğŸ“‚ Wechsle in backend/: $(pwd)"

echo "ğŸ“¦ Installiere Production-Dependencies via Yarn..."
yarn install --production --silent

echo "ğŸ”¨ FÃ¼hre Build aus..."
yarn build

mkdir -p logs
echo "ğŸ“ logs/-Ordner erstellt (fÃ¼r PM2)."

echo "âœ… install_dependencies abgeschlossen!"
